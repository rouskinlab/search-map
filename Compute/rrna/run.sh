#!/bin/bash

set -euxo pipefail

SCRIPT=../util/pairs_vs_correl.py
FIG_DIR=../../MainFigures/rrna
MOD_23S=models/fold/ecoli-23S/full/d.23.b.E.coli.ct
MOD_16S=models/fold/ecoli-16S/full/d.16.b.E.coli.ct

seismic -vv align -x fq-mv-240125 ecoli-rrna.fa
seismic -vv relate ecoli-rrna.fa out
seismic -v table --no-table-read out/*/relate
# Mask positions with <5000 reads or mutation rates >0.01 in the untreated control.
seismic -vv mask --min-ninfo-pos 5000 --exclude-pos ecoli-23S 8 --exclude-pos ecoli-23S 174 --exclude-pos ecoli-23S 176 --exclude-pos ecoli-23S 183 --exclude-pos ecoli-23S 184 --exclude-pos ecoli-23S 224 --exclude-pos ecoli-23S 225 --exclude-pos ecoli-23S 227 --exclude-pos ecoli-23S 228 --exclude-pos ecoli-23S 229 --exclude-pos ecoli-23S 264 --exclude-pos ecoli-23S 270 --exclude-pos ecoli-23S 316 --exclude-pos ecoli-23S 441 --exclude-pos ecoli-23S 464 --exclude-pos ecoli-23S 472 --exclude-pos ecoli-23S 542 --exclude-pos ecoli-23S 576 --exclude-pos ecoli-23S 645 --exclude-pos ecoli-23S 646 --exclude-pos ecoli-23S 664 --exclude-pos ecoli-23S 693 --exclude-pos ecoli-23S 694 --exclude-pos ecoli-23S 723 --exclude-pos ecoli-23S 724 --exclude-pos ecoli-23S 727 --exclude-pos ecoli-23S 756 --exclude-pos ecoli-23S 772 --exclude-pos ecoli-23S 773 --exclude-pos ecoli-23S 783 --exclude-pos ecoli-23S 846 --exclude-pos ecoli-23S 852 --exclude-pos ecoli-23S 853 --exclude-pos ecoli-23S 854 --exclude-pos ecoli-23S 973 --exclude-pos ecoli-23S 1021 --exclude-pos ecoli-23S 1022 --exclude-pos ecoli-23S 1023 --exclude-pos ecoli-23S 1033 --exclude-pos ecoli-23S 1134 --exclude-pos ecoli-23S 1135 --exclude-pos ecoli-23S 1171 --exclude-pos ecoli-23S 1178 --exclude-pos ecoli-23S 1188 --exclude-pos ecoli-23S 1189 --exclude-pos ecoli-23S 1190 --exclude-pos ecoli-23S 1211 --exclude-pos ecoli-23S 1220 --exclude-pos ecoli-23S 1229 --exclude-pos ecoli-23S 1420 --exclude-pos ecoli-23S 1421 --exclude-pos ecoli-23S 1422 --exclude-pos ecoli-23S 1423 --exclude-pos ecoli-23S 1425 --exclude-pos ecoli-23S 1427 --exclude-pos ecoli-23S 1434 --exclude-pos ecoli-23S 1483 --exclude-pos ecoli-23S 1488 --exclude-pos ecoli-23S 1553 --exclude-pos ecoli-23S 1641 --exclude-pos ecoli-23S 1657 --exclude-pos ecoli-23S 1658 --exclude-pos ecoli-23S 1670 --exclude-pos ecoli-23S 1671 --exclude-pos ecoli-23S 1693 --exclude-pos ecoli-23S 1694 --exclude-pos ecoli-23S 1723 --exclude-pos ecoli-23S 1725 --exclude-pos ecoli-23S 1726 --exclude-pos ecoli-23S 1727 --exclude-pos ecoli-23S 1730 --exclude-pos ecoli-23S 1733 --exclude-pos ecoli-23S 1734 --exclude-pos ecoli-23S 1735 --exclude-pos ecoli-23S 1759 --exclude-pos ecoli-23S 1765 --exclude-pos ecoli-23S 1789 --exclude-pos ecoli-23S 1811 --exclude-pos ecoli-23S 1812 --exclude-pos ecoli-23S 1865 --exclude-pos ecoli-23S 1971 --exclude-pos ecoli-23S 2045 --exclude-pos ecoli-23S 2060 --exclude-pos ecoli-23S 2062 --exclude-pos ecoli-23S 2099 --exclude-pos ecoli-23S 2132 --exclude-pos ecoli-23S 2203 --exclude-pos ecoli-23S 2211 --exclude-pos ecoli-23S 2233 --exclude-pos ecoli-23S 2248 --exclude-pos ecoli-23S 2249 --exclude-pos ecoli-23S 2250 --exclude-pos ecoli-23S 2268 --exclude-pos ecoli-23S 2291 --exclude-pos ecoli-23S 2292 --exclude-pos ecoli-23S 2305 --exclude-pos ecoli-23S 2314 --exclude-pos ecoli-23S 2441 --exclude-pos ecoli-23S 2442 --exclude-pos ecoli-23S 2443 --exclude-pos ecoli-23S 2507 --exclude-pos ecoli-23S 2525 --exclude-pos ecoli-23S 2543 --exclude-pos ecoli-23S 2573 --exclude-pos ecoli-23S 2579 --exclude-pos ecoli-23S 2621 --exclude-pos ecoli-23S 2622 --exclude-pos ecoli-23S 2637 --exclude-pos ecoli-23S 2639 --exclude-pos ecoli-23S 2640 --exclude-pos ecoli-23S 2641 --exclude-pos ecoli-23S 2728 --exclude-pos ecoli-23S 2750 --exclude-pos ecoli-23S 2794 --exclude-pos ecoli-23S 2796 --exclude-pos ecoli-23S 2799 --exclude-pos ecoli-23S 2802 --exclude-pos ecoli-23S 2810 --exclude-pos ecoli-23S 2820 --exclude-pos ecoli-23S 2821 --exclude-pos ecoli-23S 2823 --exclude-pos ecoli-23S 2824 --exclude-pos ecoli-23S 2826 --exclude-pos ecoli-23S 2835 --exclude-pos ecoli-23S 2836 --exclude-pos ecoli-23S 2837 --exclude-pos ecoli-23S 2838 --exclude-pos ecoli-23S 2839 --exclude-pos ecoli-23S 2840 --exclude-pos ecoli-23S 2841 --exclude-pos ecoli-23S 2853 --exclude-pos ecoli-23S 2889 --exclude-pos ecoli-23S 2890 --exclude-pos ecoli-23S 2891 --exclude-pos ecoli-23S 2892 --exclude-pos ecoli-23S 2893 --exclude-pos ecoli-23S 2897 --exclude-pos ecoli-23S 2898 --exclude-pos ecoli-23S 2900 --exclude-pos ecoli-23S 2903 out/*/relate/ecoli-23S
seismic table --no-table-read out/*/mask
seismic -v graph profile out/*/table/ecoli-*/full/mask-per-pos.csv
seismic -v graph profile --use-count -r n out/*/table/ecoli-*/full/mask-per-pos.csv
seismic -v graph corroll -m pcc out/*/table/ecoli-*/full/mask-per-pos.csv
python $SCRIPT -s $MOD_23S -d out/MV_6_S1_L001__and__MV_7_S2_L001/graph/ecoli-23S/full/corroll_masked_m-ratio-q0_45-9_pcc.csv -a asos/0.csv -o $FIG_DIR/0
python $SCRIPT -s $MOD_23S -d out/MV_6_S1_L001__and__MV_9_S3_L001/graph/ecoli-23S/full/corroll_masked_m-ratio-q0_45-9_pcc.csv -a asos/1a.csv -o $FIG_DIR/1a
python $SCRIPT -s $MOD_23S -d out/MV_10_S4_L001__and__MV_6_S1_L001/graph/ecoli-23S/full/corroll_masked_m-ratio-q0_45-9_pcc.csv -a asos/1b.csv -o $FIG_DIR/1b
python $SCRIPT -s $MOD_23S -d out/MV_11_S5_L001__and__MV_6_S1_L001/graph/ecoli-23S/full/corroll_masked_m-ratio-q0_45-9_pcc.csv -a asos/2a.csv -o $FIG_DIR/2a
python $SCRIPT -s $MOD_23S -d out/MV_12_S6_L001__and__MV_6_S1_L001/graph/ecoli-23S/full/corroll_masked_m-ratio-q0_45-9_pcc.csv -a asos/2b.csv -o $FIG_DIR/2b

rm -r log

